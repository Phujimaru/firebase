<!DOCTYPE html>
<html>
<head>
    <title>Classroom Check-in</title>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/vuetify@3.4.10/dist/vuetify.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/vuetify@3.4.10/dist/vuetify.min.js"></script>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            overflow: hidden;
        }
        .full-height {
            height: 100vh;
        }
        .login-bg {
            background: url('https://source.unsplash.com/1600x900/?classroom') center/cover no-repeat;
        }
        .text-shadow {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>
    <div id="app">
        <v-app>
            <template v-if="!user">
                <!-- หน้า Login -->
                <v-container class="full-height login-bg d-flex justify-center align-center">
                    <v-card class="pa-5 text-center" elevation="10" style="opacity: 0.9;">
                        <h1 class="text-shadow">Welcome to Classroom Check-in</h1>
                        <p class="mb-4">Please login to continue</p>
                        <v-btn @click="google_login" color="green" block>
                            Login with Google
                        </v-btn>
                    </v-card>
                </v-container>
            </template>

            <template v-else>
                <v-container fluid class="full-height">
                    <v-row class="fill-height">
                        <!-- Sidebar เมนูทางซ้าย -->
                        <v-col cols="12" md="3" class="pa-4" style="background-color: #f4f4f9;">
                            <v-card class="pa-3" elevation="3">
                                <v-avatar class="user-avatar" v-if="user">
                                    <img :src="user.photoURL" class="rounded-circle" />
                                </v-avatar>
                                <div v-if="user" class="user-details mt-3">
                                    <strong>{{ user.displayName }}</strong>
                                    <p>{{ user.email }}</p>
                                    <p>Status: 
                                        <span :class="userStatus === 1 ? 'text-blue' : 'text-green'">
                                            {{ userStatus === 1 ? 'Teacher' : 'Student' }}
                                        </span>
                                    </p>
                                </div>
                                <!-- ปุ่มเมนู -->
                                <v-divider class="mt-3 mb-3"></v-divider>
                                <v-btn v-if="userStatus === 1" color="primary" block class="mb-2" @click="goToCreateClassroom">
                                    สร้างวิชาเรียน
                                </v-btn>
                                <v-btn @click="google_logout" color="red" block class="mb-2">
                                    Logout
                                </v-btn>
                            </v-card>
                        </v-col>

                        <!-- แสดงรายละเอียดวิชาเรียน -->
                        <v-col cols="12" md="9" class="pa-4">
                            <v-container fluid>
                                <v-row>
                                    <v-col cols="12" md="6" v-for="classroom in classrooms" :key="classroom.id">
                                        <v-card elevation="2">
                                            <v-img :src="classroom.image" height="200px"></v-img>
                                            <v-card-title>{{ classroom.name }}</v-card-title>
                                            <v-card-subtitle>{{ classroom.teacher }}</v-card-subtitle>
                                            <v-card-actions>
                                                <v-btn color="blue" @click="goToEditPage(classroom.id)">Edit</v-btn>
                                            </v-card-actions>
                                        </v-card>
                                    </v-col>
                                </v-row>
                            </v-container>
                        </v-col>
                    </v-row>
                </v-container>
            </template>
        </v-app>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCsB5O8vwk_EhCmME6Zg6CqN1gVFl4eJik",
            authDomain: "projectwebm2025.firebaseapp.com",
            projectId: "projectwebm2025",
            storageBucket: "projectwebm2025.firebasestorage.app",
            messagingSenderId: "316415805582",
            appId: "1:316415805582:web:582b27fa7d4f8974bee1df",
            measurementId: "G-EC8J8RGC0T"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const { createApp, ref } = Vue;
        const vuetify = Vuetify.createVuetify();

        createApp({
            data() {
                return {
                    user: null,
                    userStatus: null,
                    classrooms: []
                };
            },
            methods: {
                google_login() {
                    const provider = new firebase.auth.GoogleAuthProvider();
                    firebase.auth().signInWithPopup(provider).then(result => {
                        this.user = result.user;
                        this.checkUserStatus();
                    });
                },
                google_logout() {
                    firebase.auth().signOut().then(() => {
                        this.user = null;
                        this.userStatus = null;
                    });
                },
                checkUserStatus() {
                    if (this.user) {
                        db.collection('users').doc(this.user.uid).collection('classroom').doc('status').get()
                            .then(doc => {
                                if (doc.exists) {
                                    this.userStatus = doc.data().status;
                                }
                            });
                    }
                },
                goToCreateClassroom() {
    window.location.href = 'edit.html';
},

                goToEditPage(classroomId) {
                    alert("ไปหน้า Edit ของ Classroom ID: " + classroomId);
                }
            },
            mounted() {
                firebase.auth().onAuthStateChanged(user => {
                    this.user = user;
                    if (user) {
                        this.checkUserStatus();
                    }
                });
                db.collection('classrooms').get().then(snapshot => {
                    this.classrooms = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                });
            }
        }).use(vuetify).mount("#app");
    </script>
</body>
</html>

