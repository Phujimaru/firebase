




<!DOCTYPE html>
<html lang="th">
<head>
  <title>ระบบจัดการนักศึกษา - Firebase Auth</title>
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>

  <!-- Vue 3 + Vuetify -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/vuetify@3.4.10/dist/vuetify.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/vuetify@3.4.10/dist/vuetify.min.js"></script>

  <!-- Material Icons -->
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font/css/materialdesignicons.min.css" rel="stylesheet">
</head>
<body>
  <div id="app">
    <v-app>
      <v-container>
        <v-card>
          <v-card-title class="bg-blue-grey">ระบบจัดการผู้ใช้</v-card-title>
          <v-card-text class="pa-6">
            <v-card-actions>
              <template v-if="user">
                <div class="pa-2">
                  <v-avatar><img :src="user.photo" /></v-avatar>
                </div>
                <div class="pa-2">
                  {{ user.name }}<br />
                  {{ user.email }}<br />
                </div>
              </template>
              <v-btn @click="google_login" v-if="!user">Login</v-btn>
              <v-btn @click="google_logout" v-if="user">Logout</v-btn>
            </v-card-actions>
          </v-card-text>

          <!-- ตารางแสดง Users -->
          <table width="100%" border="1">
            <thead>
              <tr>
                <td>UID</td>
                <td>ชื่อ</td>
                <td>Email</td>
                <td>รูปโปรไฟล์</td>
              </tr>
            </thead>
            <tbody>
              <tr v-for="u in users" :key="u.id">
                <td>{{ u.id }}</td>
                <td>{{ u.name }}</td>
                <td>{{ u.email }}</td>
                <td><v-avatar><img :src="u.photo" /></v-avatar></td>
              </tr>
            </tbody>
          </table>
        </v-card>
      </v-container>        
    </v-app>
  </div>

  <script>
    // ✅ ตั้งค่า Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCQ6hymNSFTOungZGp2_iZVcNnqvVrhqJQ",
      authDomain: "web2567phupha.firebaseapp.com",
      projectId: "web2567phupha",
      storageBucket: "web2567phupha.firebasestorage.app",
      messagingSenderId: "880101399133",
      appId: "1:880101399133:web:03a059543250e03a4d4bb4",
      measurementId: "G-QDB8L9G7S4"
    };


    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const vuetify = Vuetify.createVuetify();

    const app = Vue.createApp({
      data() {
        return {
          users: [],
          user: null,
        };
      },
      mounted() {
        firebase.auth().onAuthStateChanged(user => {
          if (user) {
            this.user = { name: user.displayName, email: user.email, photo: user.photoURL };
            this.saveUserToFirestore(user);
          } else {
            this.user = null;
          }
        });
        this.readData();
      },
      methods: {
        google_login() {
          const provider = new firebase.auth.GoogleAuthProvider();
          firebase.auth().signInWithPopup(provider);
        },
        google_logout() {
          firebase.auth().signOut();
        },
        saveUserToFirestore(user) {
          const userRef = db.collection("users").doc(user.uid);
          userRef.get().then(doc => {
            if (!doc.exists) {
              userRef.set({
                name: user.displayName,
                email: user.email,
                photo: user.photoURL
              });
            }
          });
        },
        readData() {
          db.collection("users").onSnapshot(snapshot => {
            this.users = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          });
        }
      }
    });

    app.use(vuetify).mount("#app");
  </script>
</body>
</html>
